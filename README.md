# AWS Utils Library

Utility library for AWS Services with clean interfaces and to abstract complexity away.

Generated by projen.

Built through github actions.

# Authenticator

Th first step is to create an authenticator. This allows a user to sign in and authenticate themselves. A providerId along with an access token should be returned.

```
const authenticator = makeCognitoAuthenticator({
  config: {
    region,
    userPoolId: "eu-central-1_qJsskDss",
    clientId: "23s9w99ww",
  },
});

await authenticator.authenticate({
  username,
  password,
});
```

# Authoriser

Once authenticated the next thing to do is authoriser yourself with AWS and get your access credentials along with an identityId if supported.

```
const authoriser = makeCognitoAuthoriser({
  config: {
    identityPoolId: "eu-central-1:39736276-2ef6-48b7-bc9b-5599792nd82",
    accountId: "927438389348",
    region,
  },
  authenticationProvider: authenticator,
});
```

# Get credentials

We can now get our credentials from the authoriser.

```
const authorisation = await authoriser.authorise();
```

This will use the authenticator to refresh tokens every time authorise is called.

If refresh fails then authorisation will fail -> SessionTimedOutException

If the user is not authorised to use the service it will fail -> AuthorisationRejectedException

If successful access key, secret and optionally identity id will be returned.

# Authorise AWS Services

The best way to use AWS services is to create a library for them which uses the authorisation provider

```
const s3 = makeS3Storage({
  authoriser: authoriser,
  config: {
    bucketName:
      "core-infrastructure",
    region,
  },
});
```

Then when you call any operation on this it will ask the authorisation provider to authorise the request.

The authoriser will ensure the user is still authenticated and refresh if not.

And then the request will be sent to the AWS service with fresh credentials.

# Reloading in an app / website without logging in again

Each authenticator is passed a storage provider which can be used to store the authorisation information needed to refresh a session, generally a user and token.
